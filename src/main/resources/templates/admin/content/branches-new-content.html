<div class="max-w-3xl mx-auto">
    <div class="bg-white shadow rounded-lg">
        <div class="px-6 py-4 border-b border-gray-200">
            <h3 class="text-lg font-semibold text-gray-900">Add New Branch</h3>
            <p class="text-sm text-gray-500 mt-1">Register a new branch in the system</p>
        </div>
        <div class="p-6 space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Branch Code</label>
                    <input type="text" name="branchCode" class="w-full border border-gray-300 rounded-md px-3 py-2 bg-gray-100" th:value="${generatedBranchCode}" readonly>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Branch Name</label>
                    <input type="text" class="w-full border border-gray-300 rounded-md px-3 py-2">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">City</label>
                    <input type="text" class="w-full border border-gray-300 rounded-md px-3 py-2">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">State/Region</label>
                    <input type="text" class="w-full border border-gray-300 rounded-md px-3 py-2">
                </div>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Address</label>
                <textarea rows="3" class="w-full border border-gray-300 rounded-md px-3 py-2"></textarea>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Manager</label>
                    <input type="text" id="managerSearch" class="w-full border border-gray-300 rounded-md px-3 py-2 mb-2" placeholder="Search users...">
                    <select id="managerSelect" name="managerId" class="w-full border border-gray-300 rounded-md px-3 py-2" th:with="managerList=${users}">
                        <option value="" disabled selected>Select a manager</option>
                        <option th:each="u : ${managerList}"
                                th:value="${u.id}"
                                th:text="${u.firstName} + ' ' + ${u.lastName} + ' (' + ${u.username} + ')'">
                            <!-- User option -->
                        </option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                    <select class="w-full border border-gray-300 rounded-md px-3 py-2">
                        <option>Active</option>
                        <option>Maintenance</option>
                        <option>Closed</option>
                    </select>
                </div>
            </div>
            <div class="pt-2">
                <button class="w-full bg-banking-blue text-white px-4 py-2 rounded-md hover:bg-blue-700">
                    <i class="fas fa-save mr-2"></i>Save Branch
                </button>
            </div>
        </div>
    </div>
</div>
<script>
    (function() {
        const searchInput = document.getElementById('managerSearch');
        const select = document.getElementById('managerSelect');
        if (!searchInput || !select) return;

        // Cache original options
        const originalOptions = Array.from(select.options).map(o => ({
            value: o.value,
            text: o.text,
            disabled: o.disabled,
            selected: o.selected
        }));

        function filterOptions(query) {
            const normalized = query.trim().toLowerCase();
            // Preserve first placeholder option
            const placeholder = originalOptions[0];
            const filtered = originalOptions.slice(1).filter(o => o.text.toLowerCase().includes(normalized));

            // Rebuild select
            select.innerHTML = '';
            const placeholderEl = document.createElement('option');
            placeholderEl.value = placeholder.value;
            placeholderEl.text = placeholder.text || 'Select a manager';
            placeholderEl.disabled = true;
            placeholderEl.selected = !select.value;
            select.appendChild(placeholderEl);

            filtered.forEach(o => {
                const opt = document.createElement('option');
                opt.value = o.value;
                opt.text = o.text;
                select.appendChild(opt);
            });
        }

        searchInput.addEventListener('input', function(e) {
            filterOptions(e.target.value);
        });
    })();
</script>
