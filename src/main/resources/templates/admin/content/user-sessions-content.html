<div class="max-w-7xl mx-auto">
    <div class="flex items-center justify-between mb-6">
        <div>
            <h1 class="text-2xl font-semibold">User Sessions</h1>
            <p class="text-sm text-gray-600 mt-1">Monitor and manage active user sessions</p>
        </div>
        <a href="/superuser/dashboard/legacy" class="px-3 py-2 bg-gray-100 text-gray-700 rounded hover:bg-gray-200">Back</a>
    </div>

    <!-- Date Filters -->
    <div class="mb-6">
        <div class="flex space-x-2">
            <button class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50">
                &lt; All dates
            </button>
            <button class="px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md">
                July 2025
            </button>
            <button class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50">
                August 2025
            </button>
            <button class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50">
                September 2025
            </button>
        </div>
    </div>

    <!-- Search and Filter Section -->
    <div class="bg-white shadow rounded-lg mb-6">
        <div class="px-6 py-4 border-b border-gray-200">
            <h3 class="text-lg font-medium text-gray-900">Search and Filter</h3>
        </div>
        <div class="p-6">
            <form method="get" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">is active</label>
                        <select name="isActive" class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm">
                            <option value="">All</option>
                            <option value="true" th:selected="${isActive == 'true'}">Yes</option>
                            <option value="false" th:selected="${isActive == 'false'}">No</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">created at</label>
                        <input type="date" name="createdFrom" th:value="${createdFrom}" class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">last activity</label>
                        <input type="date" name="createdTo" th:value="${createdTo}" class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ip address</label>
                        <input type="text" name="ipAddress" th:value="${ipAddress}" placeholder="Enter IP address" class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm">
                    </div>
                </div>
                <div class="flex justify-between items-center">
                    <div class="flex items-center space-x-4">
                        <input type="text" name="search" th:value="${search}" placeholder="Search..." class="border border-gray-300 rounded-md px-3 py-2 text-sm w-64">
                        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                            <i class="fas fa-search mr-2"></i>Search
                        </button>
                    </div>
                    <div class="flex items-center space-x-4">
                        <form id="bulkActionForm" method="post" class="flex items-center space-x-4">
                            <select id="bulkActionSelect" class="border border-gray-300 rounded-md px-3 py-2 text-sm">
                                <option value="">----------</option>
                                <option value="deactivate">Deactivate selected sessions</option>
                                <option value="delete">Delete selected sessions</option>
                            </select>
                            <button type="button" id="bulkActionButton" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium" disabled>
                                Go
                            </button>
                        </form>
                    </div>
                    <div class="text-sm text-gray-500">
                        <span id="selectedCount">0</span> of <span th:text="${totalSessions}">0</span> selected
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- User Sessions Table -->
    <div class="bg-white shadow rounded-lg overflow-hidden">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left">
                        <input type="checkbox" id="selectAll" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        <a href="#" class="group inline-flex items-center">
                            User
                            <i class="fas fa-sort-up ml-1 text-blue-600"></i>
                        </a>
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Ip address
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        <a href="#" class="group inline-flex items-center">
                            Created at
                            <i class="fas fa-sort-down ml-1 text-blue-600"></i>
                        </a>
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Last activity
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Is active
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Session Duration
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Location
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Actions
                    </th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                <tr th:each="session : ${sessions}" class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap">
                        <input type="checkbox" th:value="${session.id}" class="row-checkbox rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900" th:text="${session.user.username}">admin</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900" th:text="${session.ipAddress}">127.0.0.1</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900" th:text="${#temporals.format(session.createdAt, 'MMM d, yyyy, h:mm a')}">Sept. 4, 2025, 5:14 p.m.</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900" th:text="${#temporals.format(session.lastActivity, 'MMM d, yyyy, h:mm a')}">Sept. 5, 2025, 4:36 a.m.</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span th:if="${session.isActive}" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                            <i class="fas fa-check text-green-600 mr-1"></i>
                            Active
                        </span>
                        <span th:unless="${session.isActive}" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                            <i class="fas fa-times text-red-600 mr-1"></i>
                            Inactive
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900" th:text="${session.sessionDuration}">11.4 hours</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-500">Unknown</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <div class="flex space-x-2">
                            <a th:href="@{/admin/user-sessions/{id}(id=${session.id})}" class="text-blue-600 hover:text-blue-900">
                                <i class="fas fa-eye"></i> View
                            </a>
                            <form th:if="${session.isActive}" th:action="@{/admin/user-sessions/{id}/deactivate(id=${session.id})}" method="post" class="inline">
                                <button type="submit" class="text-red-600 hover:text-red-900" onclick="return confirm('Are you sure you want to deactivate this session?')">
                                    <i class="fas fa-ban"></i> Deactivate
                                </button>
                            </form>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<script>
    // Add checkbox selection functionality and bulk operations
    document.addEventListener('DOMContentLoaded', function() {
        const selectAllCheckbox = document.getElementById('selectAll');
        const rowCheckboxes = document.querySelectorAll('.row-checkbox');
        const selectedCount = document.getElementById('selectedCount');
        const bulkActionSelect = document.getElementById('bulkActionSelect');
        const bulkActionButton = document.getElementById('bulkActionButton');
        
        function updateSelectedCount() {
            const checkedBoxes = document.querySelectorAll('.row-checkbox:checked');
            const totalBoxes = rowCheckboxes.length;
            selectedCount.textContent = `${checkedBoxes.length} of ${totalBoxes} selected`;
            
            // Enable/disable bulk action button
            bulkActionButton.disabled = checkedBoxes.length === 0 || bulkActionSelect.value === '';
        }
        
        function getSelectedIds() {
            const checkedBoxes = document.querySelectorAll('.row-checkbox:checked');
            return Array.from(checkedBoxes).map(cb => cb.value);
        }
        
        selectAllCheckbox.addEventListener('change', function() {
            rowCheckboxes.forEach(checkbox => {
                checkbox.checked = this.checked;
            });
            updateSelectedCount();
        });
        
        rowCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', updateSelectedCount);
        });
        
        bulkActionSelect.addEventListener('change', updateSelectedCount);
        
        bulkActionButton.addEventListener('click', function() {
            const selectedIds = getSelectedIds();
            if (selectedIds.length === 0) {
                alert('Please select at least one user session.');
                return;
            }
            
            const action = bulkActionSelect.value;
            
            switch(action) {
                case 'deactivate':
                    if (confirm(`Are you sure you want to deactivate ${selectedIds.length} user session(s)?`)) {
                        submitBulkAction('/admin/user-sessions/bulk-deactivate', selectedIds);
                    }
                    break;
                    
                case 'delete':
                    if (confirm(`Are you sure you want to delete ${selectedIds.length} user session(s)?`)) {
                        submitBulkAction('/admin/user-sessions/bulk-delete', selectedIds);
                    }
                    break;
            }
        });
        
        function submitBulkAction(url, selectedIds) {
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = url;
            
            selectedIds.forEach(id => {
                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = 'selectedIds';
                input.value = id;
                form.appendChild(input);
            });
            
            document.body.appendChild(form);
            form.submit();
        }
    });
</script>
