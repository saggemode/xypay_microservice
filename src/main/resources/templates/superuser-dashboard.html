<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" th:replace="~{layouts/legacy-layout :: layout('Superuser Dashboard', ~{::content})}">
<body>
    <div th:fragment="content" x-data="{...dashboardNotifications()}">
        <!-- Main Content -->
        <div class="px-4 sm:px-6 lg:px-8 py-8">
                <!-- Welcome Section -->
                <div class="bg-white rounded-lg shadow p-6 mb-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <div class="w-12 h-12 bg-banking-blue rounded-full flex items-center justify-center">
                                    <i class="fas fa-shield-alt text-white text-xl"></i>
                                </div>
                            </div>
                            <div class="ml-4">
                                <h2 class="text-xl font-semibold text-gray-900">Welcome to Superuser Dashboard</h2>
                                <p class="text-sm text-gray-500">Complete system administration and oversight capabilities</p>
                            </div>
                        </div>
                </div>
                <!-- System Stats -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-lg shadow p-5">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <i class="fas fa-users text-banking-blue text-2xl"></i>
                                </div>
                                <div class="ml-5 w-0 flex-1">
                                    <dl>
                                        <dt class="text-sm font-medium text-gray-500 truncate">Total Users</dt>
                                        <dd class="text-lg font-medium text-gray-900" th:text="${totalUsers ?: '1'}">1</dd>
                                    </dl>
                                </div>
                            </div>
                    </div>

                    <div class="bg-white rounded-lg shadow p-5">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <i class="fas fa-building text-banking-blue text-2xl"></i>
                                </div>
                                <div class="ml-5 w-0 flex-1">
                                    <dl>
                                        <dt class="text-sm font-medium text-gray-500 truncate">Active Branches</dt>
                                        <dd class="text-lg font-medium text-gray-900" th:text="${totalBranches ?: '1'}">1</dd>
                                    </dl>
                                </div>
                            </div>
                    </div>

                    <div class="bg-white rounded-lg shadow p-5">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <i class="fas fa-exchange-alt text-banking-blue text-2xl"></i>
                                </div>
                                <div class="ml-5 w-0 flex-1">
                                    <dl>
                                        <dt class="text-sm font-medium text-gray-500 truncate">Today's Transactions</dt>
                                        <dd class="text-lg font-medium text-gray-900" th:text="${todayTransactions ?: '0'}">0</dd>
                                    </dl>
                                </div>
                            </div>
                    </div>

                    <div class="bg-white rounded-lg shadow p-5">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <i class="fas fa-shield-alt text-green-600 text-2xl"></i>
                                </div>
                                <div class="ml-5 w-0 flex-1">
                                    <dl>
                                        <dt class="text-sm font-medium text-gray-500 truncate">System Status</dt>
                                        <dd class="text-lg font-medium text-green-600">Online</dd>
                                    </dl>
                                </div>
                            </div>
                    </div>
                </div>

                <!-- Django Admin Style Feature Grid -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                    <!-- Core Banking -->
                    <div class="bg-white shadow rounded-lg">
                        <div class="px-4 py-5 sm:p-6">
                            <h3 class="text-lg font-medium text-gray-900 mb-4">
                                <i class="fas fa-university mr-2 text-banking-blue"></i>Core Banking
                            </h3>
                            <div class="space-y-2">
                                <a href="/admin/accounts" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-wallet w-4 mr-2 text-banking-blue"></i>Accounts
                                </a>
                                <a href="/admin/customers" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-users w-4 mr-2 text-banking-blue"></i>Customers
                                </a>
                                <a href="/admin/transactions" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-exchange-alt w-4 mr-2 text-banking-blue"></i>Transactions
                                </a>
                                <a href="/admin/branches" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-building w-4 mr-2 text-banking-blue"></i>Branches
                                </a>
                                <a href="/admin/balances" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-balance-scale w-4 mr-2 text-banking-blue"></i>Balances
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Loan Management -->
                    <div class="bg-white shadow rounded-lg">
                        <div class="px-4 py-5 sm:p-6">
                            <h3 class="text-lg font-medium text-gray-900 mb-4">
                                <i class="fas fa-hand-holding-usd mr-2 text-green-600"></i>Loan Management
                            </h3>
                            <div class="space-y-2">
                                <a href="/admin/loans" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-file-contract w-4 mr-2 text-green-600"></i>Loans
                                </a>
                                <a href="/admin/loan-products" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-tags w-4 mr-2 text-green-600"></i>Loan Products
                                </a>
                                <a href="/admin/loan-repayments" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-money-bill-wave w-4 mr-2 text-green-600"></i>Repayments
                                </a>
                                <a href="/admin/loan-amortization" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-calculator w-4 mr-2 text-green-600"></i>Amortization
                                </a>
                                <a href="/admin/interest-calculator" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-percent w-4 mr-2 text-green-600"></i>Interest Calculator
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Trade Finance -->
                    <div class="bg-white shadow rounded-lg">
                        <div class="px-4 py-5 sm:p-6">
                            <h3 class="text-lg font-medium text-gray-900 mb-4">
                                <i class="fas fa-globe mr-2 text-purple-600"></i>Trade Finance
                            </h3>
                            <div class="space-y-2">
                                <a href="/admin/trade-finance" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-ship w-4 mr-2 text-purple-600"></i>Trade Finance
                                </a>
                                <a href="/admin/trade-documents" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-file-alt w-4 mr-2 text-purple-600"></i>Trade Documents
                                </a>
                                <a href="/admin/trade-amendments" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-edit w-4 mr-2 text-purple-600"></i>Amendments
                                </a>
                                <a href="/admin/iso20022" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-code w-4 mr-2 text-purple-600"></i>ISO20022
                                </a>
                                <a href="/admin/swift" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-paper-plane w-4 mr-2 text-purple-600"></i>SWIFT Messages
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Treasury Operations -->
                    <div class="bg-white shadow rounded-lg">
                        <div class="px-4 py-5 sm:p-6">
                            <h3 class="text-lg font-medium text-gray-900 mb-4">
                                <i class="fas fa-chart-line mr-2 text-blue-600"></i>Treasury Operations
                            </h3>
                            <div class="space-y-2">
                                <a href="/admin/treasury-operations" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-coins w-4 mr-2 text-blue-600"></i>Treasury Operations
                                </a>
                                <a href="/admin/treasury-positions" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-chart-pie w-4 mr-2 text-blue-600"></i>Positions
                                </a>
                                <a href="/admin/treasury-settlements" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-handshake w-4 mr-2 text-blue-600"></i>Settlements
                                </a>
                                <a href="/admin/fx-rates" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-exchange-alt w-4 mr-2 text-blue-600"></i>FX Rates
                                </a>
                                <a href="/admin/money-market" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-money-check-alt w-4 mr-2 text-blue-600"></i>Money Market
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Investment Banking -->
                    <div class="bg-white shadow rounded-lg">
                        <div class="px-4 py-5 sm:p-6">
                            <h3 class="text-lg font-medium text-gray-900 mb-4">
                                <i class="fas fa-chart-area mr-2 text-indigo-600"></i>Investment Banking
                            </h3>
                            <div class="space-y-2">
                                <a href="/admin/securities" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-certificate w-4 mr-2 text-indigo-600"></i>Securities
                                </a>
                                <a href="/admin/portfolios" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-briefcase w-4 mr-2 text-indigo-600"></i>Portfolios
                                </a>
                                <a href="/admin/security-holdings" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-layer-group w-4 mr-2 text-indigo-600"></i>Holdings
                                </a>
                                <a href="/admin/security-transactions" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-random w-4 mr-2 text-indigo-600"></i>Security Trades
                                </a>
                                <a href="/admin/market-data" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-chart-bar w-4 mr-2 text-indigo-600"></i>Market Data
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Islamic Banking -->
                    <div class="bg-white shadow rounded-lg">
                        <div class="px-4 py-5 sm:p-6">
                            <h3 class="text-lg font-medium text-gray-900 mb-4">
                                <i class="fas fa-mosque mr-2 text-teal-600"></i>Islamic Banking
                            </h3>
                            <div class="space-y-2">
                                <a href="/admin/islamic-products" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-star-and-crescent w-4 mr-2 text-teal-600"></i>Islamic Products
                                </a>
                                <a href="/admin/islamic-contracts" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-scroll w-4 mr-2 text-teal-600"></i>Contracts
                                </a>
                                <a href="/admin/islamic-payments" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-hand-holding-heart w-4 mr-2 text-teal-600"></i>Payments
                                </a>
                                <a href="/admin/profit-distribution" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-share-alt w-4 mr-2 text-teal-600"></i>Profit Distribution
                                </a>
                                <a href="/admin/sharia-compliance" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-balance-scale w-4 mr-2 text-teal-600"></i>Sharia Compliance
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Compliance & Risk -->
                    <div class="bg-white shadow rounded-lg">
                        <div class="px-4 py-5 sm:p-6">
                            <h3 class="text-lg font-medium text-gray-900 mb-4">
                                <i class="fas fa-shield-alt mr-2 text-red-600"></i>Compliance & Risk
                            </h3>
                            <div class="space-y-2">
                                <a href="/admin/kyc" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-user-check w-4 mr-2 text-red-600"></i>KYC Management
                                </a>
                                <a href="/admin/aml" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-search w-4 mr-2 text-red-600"></i>AML Monitoring
                                </a>
                                <a href="/admin/regulatory-compliance" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-gavel w-4 mr-2 text-red-600"></i>Regulatory Compliance
                                </a>
                                <a href="/admin/audit-logs" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-clipboard-list w-4 mr-2 text-red-600"></i>Audit Logs
                                </a>
                                <a href="/admin/fraud-detection" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-exclamation-triangle w-4 mr-2 text-red-600"></i>Fraud Detection
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Payment Systems -->
                    <div class="bg-white shadow rounded-lg">
                        <div class="px-4 py-5 sm:p-6">
                            <h3 class="text-lg font-medium text-gray-900 mb-4">
                                <i class="fas fa-credit-card mr-2 text-orange-600"></i>Payment Systems
                            </h3>
                            <div class="space-y-2">
                                <a href="/admin/nibss" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-university w-4 mr-2 text-orange-600"></i>NIBSS Integration
                                </a>
                                <a href="/admin/channels" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-sitemap w-4 mr-2 text-orange-600"></i>Channels
                                </a>
                                <a href="/admin/multi-channel" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-network-wired w-4 mr-2 text-orange-600"></i>Multi-Channel
                                </a>
                                <a href="/admin/stp" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-bolt w-4 mr-2 text-orange-600"></i>STP Processing
                                </a>
                                <a href="/admin/reconciliation" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-check-double w-4 mr-2 text-orange-600"></i>Reconciliation
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- System Administration -->
                    <div class="bg-white shadow rounded-lg">
                        <div class="px-4 py-5 sm:p-6">
                            <h3 class="text-lg font-medium text-gray-900 mb-4">
                                <i class="fas fa-cogs mr-2 text-gray-600"></i>System Administration
                            </h3>
                            <div class="space-y-2">
                                <a href="/admin/users" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-users w-4 mr-2 text-gray-600"></i>Users
                                </a>
                                <a href="/admin/roles" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-user-shield w-4 mr-2 text-gray-600"></i>Roles & Permissions
                                </a>
                                <a href="/admin/configurations" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-sliders-h w-4 mr-2 text-gray-600"></i>Configurations
                                </a>
                                <a href="/admin/settings" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-cog w-4 mr-2 text-gray-600"></i>System Settings
                                </a>
                                <a href="/admin/notifications" class="flex items-center p-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                                    <i class="fas fa-bell w-4 mr-2 text-gray-600"></i>Notifications
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activities -->
                <div class="bg-white shadow rounded-lg">
                    <div class="px-4 py-5 sm:p-6">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">
                            <i class="fas fa-clock mr-2 text-banking-gray"></i>Recent System Activities
                        </h3>
                        <div class="flow-root">
                            <ul class="-mb-8">
                                <li>
                                    <div class="relative pb-8">
                                        <div class="relative flex space-x-3">
                                            <div>
                                                <span class="h-8 w-8 rounded-full bg-green-500 flex items-center justify-center ring-8 ring-white">
                                                    <i class="fas fa-check text-white text-sm"></i>
                                                </span>
                                            </div>
                                            <div class="min-w-0 flex-1 pt-1.5 flex justify-between space-x-4">
                                                <div>
                                                    <p class="text-sm text-gray-500">System initialization completed successfully</p>
                                                </div>
                                                <div class="text-right text-sm whitespace-nowrap text-gray-500">
                                                    <time>Just now</time>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </li>
                                <li>
                                    <div class="relative pb-8">
                                        <div class="relative flex space-x-3">
                                            <div>
                                                <span class="h-8 w-8 rounded-full bg-blue-500 flex items-center justify-center ring-8 ring-white">
                                                    <i class="fas fa-user text-white text-sm"></i>
                                                </span>
                                            </div>
                                            <div class="min-w-0 flex-1 pt-1.5 flex justify-between space-x-4">
                                                <div>
                                                    <p class="text-sm text-gray-500">Administrator account created and configured</p>
                                                </div>
                                                <div class="text-right text-sm whitespace-nowrap text-gray-500">
                                                    <time>Just now</time>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </li>
                                <li>
                                    <div class="relative">
                                        <div class="relative flex space-x-3">
                                            <div>
                                                <span class="h-8 w-8 rounded-full bg-banking-blue flex items-center justify-center ring-8 ring-white">
                                                    <i class="fas fa-database text-white text-sm"></i>
                                                </span>
                                            </div>
                                            <div class="min-w-0 flex-1 pt-1.5 flex justify-between space-x-4">
                                                <div>
                                                    <p class="text-sm text-gray-500">Database schema initialized and ready</p>
                                                </div>
                                                <div class="text-right text-sm whitespace-nowrap text-gray-500">
                                                    <time>Just now</time>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function dashboardNotifications() {
            return {
                recentNotifications: [],
                unreadCount: 0,
                sidebarOpen: false,
                sidebarCollapsed: false,
                openGroups: {
                    auth: false,
                    accounts: false,
                    address: false,
                    bank: false,
                    order: false,
                    product: false,
                    report: false,
                    sites: false,
                    social: false,
                    system: false
                },

                async init() {
                    await this.loadNotifications();
                    this.startPolling();
                },

                async loadNotifications() {
                    try {
                        const response = await fetch('/api/notifications?limit=5');
                        const data = await response.json();
                        this.recentNotifications = data.content || data;
                        this.unreadCount = this.recentNotifications.filter(n => !n.isRead).length;
                    } catch (error) {
                        console.error('Error loading notifications:', error);
                    }
                },

                async viewNotification(id) {
                    try {
                        await fetch(`/api/notifications/${id}/read`, { method: 'POST' });
                        await this.loadNotifications();
                    } catch (error) {
                        console.error('Error marking notification as read:', error);
                    }
                },

                formatDate(dateString) {
                    return new Date(dateString).toLocaleString();
                },

                startPolling() {
                    setInterval(() => {
                        this.loadNotifications();
                    }, 30000); // Poll every 30 seconds
                },

                toggleGroup(group) {
                    this.openGroups[group] = !this.openGroups[group];
                },

                isOpen(group) {
                    return this.openGroups[group];
                },

                linkClass(path) {
                    const currentPath = window.location.pathname;
                    const isActive = currentPath === path || currentPath.startsWith(path + '/');
                    return isActive 
                        ? 'flex items-center px-3 py-2 text-sm rounded bg-blue-50 text-blue-700 border-r-2 border-blue-700' 
                        : 'flex items-center px-3 py-2 text-sm rounded hover:bg-gray-100 text-gray-700';
                }
            }
        }
    </script>
    </div>
</body>
</html>
